openapi: 3.0.3
info:
  title: Accounting API
  description: |
    A financial transaction recording and viewing API that allows users to:
    - Record financial transactions (deposits and withdrawals)
    - View transaction history
    - Track account balances
    
    The API maintains running balances for each account and provides transaction history in reverse chronological order.
  version: 1.0.0
  contact:
    name: Transaction App Support
    email: support@transactionapp.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000/api
    description: Development server
  - url: https://api.transactionapp.com
    description: Production server

paths:
  /transactions:
    get:
      summary: Get all transactions
      description: |
        Retrieves all financial transactions in reverse chronological order (newest first).
        Also returns the current balance from the most recent transaction.
      operationId: getTransactions
      tags:
        - Transactions
      responses:
        '200':
          description: Successful response with transactions and current balance
          content:
            application/json:
              schema:
                type: object
                properties:
                  transactions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Transaction'
                    description: Array of transactions ordered by creation date (newest first)
                  current_balance:
                    type: number
                    format: decimal
                    description: Current balance from the most recent transaction
                    example: 1250.75
              examples:
                with_transactions:
                  summary: Response with transactions
                  value:
                    transactions:
                      - id: 1
                        account_id: "507489c9-e435-9354-634b-4f4c60456514"
                        amount: 500.00
                        balance: 1250.75
                        created_at: "2024-08-07T10:30:00.000000Z"
                        updated_at: "2024-08-07T10:30:00.000000Z"
                      - id: 2
                        account_id: "507489c9-e435-9354-634b-4f4c60456514"
                        amount: -200.50
                        balance: 750.75
                        created_at: "2024-08-07T09:15:00.000000Z"
                        updated_at: "2024-08-07T09:15:00.000000Z"
                    current_balance: 1250.75
                empty_response:
                  summary: Response with no transactions
                  value:
                    transactions: []
                    current_balance: 0
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      summary: Create a new transaction
      description: |
        Records a new financial transaction for the specified account.
        The system automatically calculates the new balance based on the account's previous balance.
        
        - Positive amounts represent deposits
        - Negative amounts represent withdrawals
        - Amount cannot be zero
      operationId: createTransaction
      tags:
        - Transactions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionRequest'
            examples:
              deposit:
                summary: Deposit example
                value:
                  account_id: "507489c9-e435-9354-634b-4f4c60456514"
                  amount: 500.00
              withdrawal:
                summary: Withdrawal example
                value:
                  account_id: "7de69c90-4c9e-4f94-a167-9f95f9f5e645"
                  amount: -200.50
      responses:
        '201':
          description: Transaction created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Transaction created successfully"
                  transaction:
                    $ref: '#/components/schemas/Transaction'
              example:
                message: "Transaction created successfully"
                transaction:
                  id: 1
                  account_id: "507489c9-e435-9354-634b-4f4c60456514"
                  amount: 500.00
                  balance: 1250.75
                  created_at: "2024-08-07T10:30:00.000000Z"
                  updated_at: "2024-08-07T10:30:00.000000Z"
        '422':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              example:
                message: "The given data was invalid."
                errors:
                  account_id: ["The account id field is required."]
                  amount: ["The amount field is required.", "The amount field cannot be 0."]
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    Transaction:
      type: object
      required:
        - id
        - account_id
        - amount
        - balance
        - created_at
        - updated_at
      properties:
        id:
          type: integer
          format: int64
          description: Unique transaction identifier
          example: 1
        account_id:
          type: string
          format: uuid
          description: Account identifier (UUID format)
          example: "507489c9-e435-9354-634b-4f4c60456514"
        amount:
          type: number
          format: decimal
          description: Transaction amount (positive for deposits, negative for withdrawals)
          example: 500.00
        balance:
          type: number
          format: decimal
          description: Account balance after this transaction
          example: 1250.75
        created_at:
          type: string
          format: date-time
          description: Transaction creation timestamp
          example: "2024-08-07T10:30:00.000000Z"
        updated_at:
          type: string
          format: date-time
          description: Transaction last update timestamp
          example: "2024-08-07T10:30:00.000000Z"

    TransactionRequest:
      type: object
      required:
        - account_id
        - amount
      properties:
        account_id:
          type: string
          format: uuid
          description: Account identifier (UUID format)
          example: "507489c9-e435-9354-634b-4f4c60456514"
        amount:
          type: number
          format: decimal
          description: Transaction amount (positive for deposits, negative for withdrawals, cannot be zero)
          example: 500.00

    Error:
      type: object
      properties:
        message:
          type: string
          description: Error message
          example: "Internal server error occurred"
        error:
          type: string
          description: Technical error details
          example: "Database connection failed"

    ValidationError:
      type: object
      properties:
        message:
          type: string
          description: General validation error message
          example: "The given data was invalid."
        errors:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
          description: Field-specific validation error messages
          example:
            account_id: ["The account id field is required."]
            amount: ["The amount field is required.", "The amount field cannot be 0."]

tags:
  - name: Transactions
    description: Financial transaction operations